# Migrating from https library

## Migrating a server that uses `https.createServer()`

Let's review how to migrate the following server, written using Node's `https` library, to `catkeys`:

```javascript
const https = require('https')

exports = () => {
  https.createServer(
    {
      cert: fs.readFileSync('/path/to/cert/fullchain.pem'),
      key: fs.readFileSync('/path/to/cert/privkey.pem')
    },
    (req, res) => {
      …
    }
  ).listen(443)
}
```

The following changes need to be made:

* Require `catkeys` instead of `https`
* `await` on `.createServer()` before chaining the returned value to `.listen(443)`
* Update the enclosing function to be `async` (or alternativly use `catkeys.createServer()` as a promise)
* Remove SSL options related to `cert`, `key` and `ca` as these are replaced by the keys generated by CATkeys

```javascript
const { https } = require('catkeys')

const serve = async () => {
  (await https.createServer(
    (req, res) => {
      …
    }
  )).listen(443)
}
```

## Migrating a client that uses `https.request()`

Let's review how to migrate the following request, written using Node's `https` library, to `catkeys`:

```javascript
const https = require('https')

const request = () => {
  const req = https.request(
    'https://example.com/',
    (res) => { … }
  )

  req.write(postData)
  req.end()
}
```

The following changes need to be made:

* Require `catkeys` instead of `https`
* `await` on `.request()` before calling further methods on the returned request object
* Update the enclosing function to use `async` (or alternativly use `catkeys.request()` as a promise)

```javascript
const { https } = require('catkeys')

const request = () => {
  const req = await https.request(
    'https://example.com/',
    (res) => { … }
  )

  req.write(postData)
  req.end()
}
```
